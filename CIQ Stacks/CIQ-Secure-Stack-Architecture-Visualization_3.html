<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CIQ Secure Stack - Technical Architecture</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #13161B;
            color: #ECECED;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 60px;
            padding-bottom: 30px;
            border-bottom: 2px solid #12A66F;
        }
        
        h1 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
            letter-spacing: -0.5px;
            color: #FFFFFF;
        }
        
        .subtitle {
            font-size: 16px;
            color: #ECECED;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 30px;
            padding-left: 15px;
            border-left: 4px solid #12A66F;
            color: #FFFFFF;
        }
        
        .grid-2col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 60px;
        }
        
        .panel {
            background: #1A1D23;
            border: 1px solid #373A41;
            padding: 30px;
        }
        
        .panel-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #FFFFFF;
        }
        
        /* Architecture Diagram */
        .arch-diagram {
            background: #1A1D23;
            border: 2px solid #373A41;
            padding: 40px;
            margin-bottom: 40px;
        }
        
        .layer {
            border: 2px solid #373A41;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
            background: #13161B;
        }
        
        .layer-label {
            position: absolute;
            top: -12px;
            left: 20px;
            background: #13161B;
            padding: 0 10px;
            font-size: 11px;
            font-weight: 600;
            color: #ECECED;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .layer-content {
            display: flex;
            gap: 20px;
            align-items: center;
            justify-content: center;
        }
        
        .component {
            background: #1A1D23;
            border: 2px solid #373A41;
            padding: 20px;
            flex: 1;
            text-align: center;
        }
        
        .component-name {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 10px;
            color: #FFFFFF;
        }
        
        .component-role {
            font-size: 12px;
            color: #ECECED;
            margin-bottom: 12px;
        }
        
        .component-features {
            font-size: 11px;
            color: #ECECED;
            text-align: left;
            line-height: 1.8;
        }
        
        .component-features div {
            padding-left: 15px;
            position: relative;
        }
        
        .component-features div::before {
            content: '•';
            position: absolute;
            left: 0;
            color: #12A66F;
        }
        
        .control-plane-highlight {
            background: #0D3325;
            border-color: #12A66F;
        }
        
        .arrow-down {
            text-align: center;
            font-size: 24px;
            color: #12A66F;
            margin: -10px 0;
            font-weight: 700;
        }
        
        .arrow-horizontal {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #12A66F;
            font-weight: 700;
        }
        
        /* Install Experience Timeline */
        .timeline {
            position: relative;
            padding-left: 40px;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #373A41;
        }
        
        .timeline-step {
            position: relative;
            margin-bottom: 30px;
            padding-left: 20px;
            background: #1A1D23;
            border: 1px solid #373A41;
            padding: 20px 20px 20px 40px;
            border-radius: 4px;
        }
        
        .timeline-marker {
            position: absolute;
            left: -11px;
            top: 20px;
            width: 30px;
            height: 30px;
            background: #373A41;
            color: #ECECED;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
            border: 2px solid #13161B;
        }
        
        .timeline-marker.active {
            background: #12A66F;
            color: #FFFFFF;
        }
        
        .step-title {
            font-size: 14px;
            font-weight: 700;
            color: #FFFFFF;
            margin-bottom: 8px;
        }
        
        .step-detail {
            font-size: 12px;
            color: #ECECED;
            line-height: 1.6;
        }
        
        .step-time {
            display: inline-block;
            background: #12A66F;
            padding: 4px 10px;
            border-radius: 3px;
            font-size: 11px;
            color: #FFFFFF;
            font-weight: 700;
            margin-top: 6px;
        }
        
        .step-output {
            margin-top: 10px;
            padding: 12px;
            background: #0A0C0F;
            color: #2BE099;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            border-radius: 4px;
            overflow-x: auto;
            border: 1px solid #373A41;
        }
        
        /* Integration Matrix */
        .integration-grid {
            display: grid;
            grid-template-columns: 150px repeat(4, 1fr);
            gap: 1px;
            background: #373A41;
            margin-bottom: 40px;
        }
        
        .integration-cell {
            background: #1A1D23;
            padding: 15px;
            font-size: 11px;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: #ECECED;
        }
        
        .integration-header {
            background: #0A0C0F;
            color: #FFFFFF;
            font-weight: 700;
            font-size: 12px;
        }
        
        .integration-label {
            background: #13161B;
            font-weight: 600;
            text-align: left;
            justify-content: flex-start;
            color: #FFFFFF;
        }
        
        .integration-active {
            background: #0D3325;
            border: 1px solid #12A66F;
        }
        
        .protocol-badge {
            background: #12A66F;
            color: #FFFFFF;
            padding: 4px 10px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 700;
            display: block;
            margin: 8px auto 6px auto;
            width: fit-content;
        }
        
        /* Tabbed View */
        .tabs {
            display: flex;
            gap: 0;
            border-bottom: 2px solid #373A41;
            margin-bottom: 30px;
        }
        
        .tab {
            padding: 12px 24px;
            background: #1A1D23;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #ECECED;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .tab:hover {
            background: #373A41;
            color: #FFFFFF;
        }
        
        .tab.active {
            background: #13161B;
            color: #FFFFFF;
            border-bottom-color: #12A66F;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Code blocks */
        .code-block {
            background: #0A0C0F;
            color: #2BE099;
            padding: 20px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
            margin: 15px 0;
            border: 1px solid #373A41;
        }
        
        .code-comment {
            color: #61656C;
        }
        
        /* Info boxes */
        .info-box {
            background: #0D3325;
            border-left: 4px solid #12A66F;
            padding: 15px 20px;
            margin: 20px 0;
        }
        
        .info-title {
            font-weight: 700;
            color: #FFFFFF;
            margin-bottom: 8px;
            font-size: 13px;
        }
        
        .info-text {
            font-size: 12px;
            color: #ECECED;
            line-height: 1.6;
        }
        
        @media (max-width: 1200px) {
            .grid-2col {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>CIQ Secure Stack: Technical Architecture</h1>
            <p class="subtitle">High-Level Design - Two Control Planes, Multi-Cloud Abstraction, Component Integration</p>
        </div>

        <!-- Tabs for different views -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('overview')">Architecture Overview</button>
            <button class="tab" onclick="showTab('install')">Install Experience</button>
            <button class="tab" onclick="showTab('integration')">Component Integration</button>
        </div>

        <!-- Tab 1: Architecture Overview -->
        <div id="overview" class="tab-content active">
            <div class="section-title">System Architecture: Two Control Planes</div>
            
            <div class="arch-diagram">
                <!-- Layer 0: User Interface -->
                <div class="layer">
                    <div class="layer-label">Layer 0 - User Interface</div>
                    <div class="layer-content">
                        <div class="component">
                            <div class="component-name">kubectl / helm</div>
                            <div class="component-role">Developer CLI Tools</div>
                            <div class="component-features">
                                <div>Standard Kubernetes API</div>
                                <div>Apply manifests</div>
                                <div>View logs and status</div>
                            </div>
                        </div>
                        <div class="component">
                            <div class="component-name">Fuzzball Dashboard</div>
                            <div class="component-role">Workload Visibility UI</div>
                            <div class="component-features">
                                <div>Cluster health monitoring</div>
                                <div>Workflow catalog (templates)</div>
                                <div>Real-time log viewing</div>
                            </div>
                        </div>
                        <div class="component">
                            <div class="component-name">Ascender Web UI</div>
                            <div class="component-role">Operations Dashboard</div>
                            <div class="component-features">
                                <div>Compliance scanning</div>
                                <div>Playbook execution</div>
                                <div>Attestation reports</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="arrow-down">↓</div>

                <!-- Layer 1: Control Planes -->
                <div class="layer">
                    <div class="layer-label">Layer 1 - Control Planes (Two Brains)</div>
                    <div class="layer-content">
                        <div class="component control-plane-highlight">
                            <div class="component-name">Fuzzball</div>
                            <div class="component-role">Workload Orchestration Brain</div>
                            <div class="component-features">
                                <div>API Server (K8s-compatible)</div>
                                <div>Scheduler (pod placement)</div>
                                <div>Controller Manager (reconcile state)</div>
                                <div>etcd (cluster state store)</div>
                                <div>Web Dashboard UI (cluster visibility)</div>
                                <div>Workflow Catalog (pre-built templates)</div>
                            </div>
                        </div>
                        
                        <div class="arrow-horizontal">↔</div>
                        
                        <div class="component control-plane-highlight">
                            <div class="component-name">Ascender Pro</div>
                            <div class="component-role">Infrastructure Automation Brain</div>
                            <div class="component-features">
                                <div>AWX Control Node (Ansible)</div>
                                <div>OpenSCAP Scanner (compliance)</div>
                                <div>Drift Detection Engine</div>
                                <div>PostgreSQL (inventory/jobs)</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-box">
                    <div class="info-title">Why Two Control Planes?</div>
                    <div class="info-text">
                        <strong>Fuzzball</strong> manages application workloads (containers, services, networking) - what developers deploy. Includes Web Dashboard for cluster visibility and Workflow Catalog with pre-built deployment templates.<br><br>
                        <strong>Ascender</strong> manages infrastructure configuration (OS settings, compliance, patching) - what ops maintains. Includes Web Portal for compliance management and playbook execution.<br><br>
                        Separation prevents app deployments from breaking OS security policies and enables different team access patterns. Developers use kubectl + Fuzzball Dashboard, ops teams use Ascender Portal.
                    </div>
                </div>

                <div class="arrow-down">↓</div>

                <!-- Layer 2: Runtime & Registry -->
                <div class="layer">
                    <div class="layer-label">Layer 2 - Container Runtime & Registry</div>
                    <div class="layer-content">
                        <div class="component">
                            <div class="component-name">Apptainer</div>
                            <div class="component-role">Container Execution Engine</div>
                            <div class="component-features">
                                <div>Rootless operation (no daemon)</div>
                                <div>CRI socket (gRPC interface)</div>
                                <div>SIF image format + OCI support</div>
                                <div>SELinux context enforcement</div>
                                <div>cgroup resource limits</div>
                            </div>
                        </div>
                        
                        <div class="arrow-horizontal">↔</div>
                        
                        <div class="component">
                            <div class="component-name">CIQ Registry</div>
                            <div class="component-role">Hardened Image Distribution</div>
                            <div class="component-features">
                                <div>OCI-compatible API</div>
                                <div>GPG signature verification</div>
                                <div>Token authentication (OAuth2)</div>
                                <div>4 image variants (80MB-600MB)</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="arrow-down">↓</div>

                <!-- Layer 3: Base OS -->
                <div class="layer">
                    <div class="layer-label">Layer 3 - Base Operating System</div>
                    <div class="layer-content">
                        <div class="component" style="max-width: 600px; margin: 0 auto;">
                            <div class="component-name">Rocky Linux from CIQ - Hardened (RLC-H)</div>
                            <div class="component-role">Security-Hardened OS Foundation</div>
                            <div class="component-features">
                                <div>LKRG kernel module (exploit prevention)</div>
                                <div>SELinux enforcing mode (targeted policy)</div>
                                <div>FIPS 140-2 cryptography (kernel + libs)</div>
                                <div>auditd + rsyslog (comprehensive logging)</div>
                                <div>firewalld (default deny policies)</div>
                                <div>OpenSCAP scanner (compliance validation)</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="arrow-down">↓</div>

                <!-- Layer 4: Infrastructure -->
                <div class="layer">
                    <div class="layer-label">Layer 4 - Infrastructure</div>
                    <div class="layer-content">
                        <div class="component" style="background: #1A1D23; border: 2px dashed #12A66F;">
                            <div class="component-name">AWS / Azure / GCP / Bare Metal</div>
                            <div class="component-role">Cloud-Agnostic Deployment</div>
                            <div class="component-features">
                                <div>cloud-init (universal boot script)</div>
                                <div>CSI drivers (cloud storage)</div>
                                <div>Cloud controller manager (LB, volumes)</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Control Plane Detail -->
            <div class="section-title">Control Plane Interaction Detail</div>
            
            <div class="grid-2col">
                <div class="panel">
                    <div class="panel-title">Fuzzball Control Plane</div>
                    <div class="component-features">
                        <div><strong>API Server:</strong> Exposes Kubernetes REST API (port 6443, TLS)</div>
                        <div><strong>Authentication:</strong> Client certs, bearer tokens, LDAP webhook</div>
                        <div><strong>Scheduler:</strong> Resource-based pod placement, affinity rules</div>
                        <div><strong>Controller Manager:</strong> Deployment, ReplicaSet, StatefulSet, Job controllers</div>
                        <div><strong>etcd Cluster:</strong> 3-node quorum, encrypted at rest (AES-GCM-256)</div>
                        <div><strong>Network:</strong> Cilium eBPF for policies, WireGuard encryption</div>
                        <div><strong>Web Dashboard:</strong> Cluster visibility, workload monitoring, log viewing</div>
                        <div><strong>Workflow Catalog:</strong> Pre-built templates for common deployment patterns</div>
                    </div>
                    
                    <div class="info-box" style="margin-top: 20px;">
                        <div class="info-title">To Fuzzball API</div>
                        <div class="code-block">
kubectl apply -f deployment.yaml
↓
API Server validates → stores in etcd
↓
Scheduler assigns to worker node
↓
Kubelet pulls pod spec
↓
Calls Apptainer CRI</div>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-title">Ascender Pro Control Plane</div>
                    <div class="component-features">
                        <div><strong>AWX Web Server:</strong> Django app (port 8080/8443)</div>
                        <div><strong>Task Engine:</strong> Celery workers for parallel execution</div>
                        <div><strong>PostgreSQL:</strong> Inventory, job history, credentials (encrypted)</div>
                        <div><strong>Redis:</strong> Message broker for task queue</div>
                        <div><strong>Ansible Runner:</strong> Executes playbooks via SSH</div>
                        <div><strong>Compliance Scanner:</strong> OpenSCAP integrated, hourly scans</div>
                    </div>
                    
                    <div class="info-box" style="margin-top: 20px;">
                        <div class="info-title">To Ascender</div>
                        <div class="code-block">
Click "Run STIG Scan"
↓
Ansible playbook executes
↓
SSH to all nodes
↓
Run: oscap xccdf eval
↓
Parse results, auto-remediate
↓
Generate XCCDF report</div>
                    </div>
                </div>
            </div>

            <!-- Data Flow -->
            <div class="section-title">Complete Data Flow: User Request → Running Container</div>
            
            <div class="code-block">
1. Developer: kubectl apply -f webapp.yaml
   └→ kubectl client → Fuzzball API Server (6443/tcp, TLS)

2. Fuzzball API Server: Validate manifest
   └→ Store in etcd (encrypted at rest)
   └→ Scheduler evaluates nodes, selects worker-01

3. Kubelet on worker-01: Watch API, see new pod assignment
   └→ Call Apptainer CRI: unix:///var/run/apptainer/apptainer.sock
   └→ gRPC request: CreateContainer(image="registry.ciq.com/rlc-h-python:9.5")

4. Apptainer: Pull image from registry
   └→ HTTPS GET registry.ciq.com/v2/rlc-h-python/manifests/9.5
   └→ Verify GPG signature (CIQ public key)
   └→ Download layers → Convert OCI to SIF
   └→ Cache at /var/lib/apptainer/cache/

5. Apptainer: Start container
   └→ Create namespaces (PID, network, mount, UTS)
   └→ Apply SELinux label: container_t
   └→ Set cgroup limits (CPU, memory)
   └→ Execute: apptainer instance start

6. Container Running
   └→ App serves traffic on pod IP (10.244.x.x)
   └→ Fuzzball routes via iptables/eBPF
   └→ Logs: stdout/stderr → kubelet → rsyslog → SIEM

7. Ascender (Parallel Monitoring - Every 60 Minutes)
   └→ Ansible playbook: Check /etc/ssh/sshd_config
   └→ Compare: current config vs. baseline
   └→ If drift detected → Auto-remediate → Log event
   └→ Notify: Ops dashboard shows "Drift corrected on worker-01"
            </div>
        </div>

        <!-- Tab 2: Install Experience -->
        <div id="install" class="tab-content">
            <div class="section-title">Customer Install Experience: From Click to Cluster</div>
            
            <div class="grid-2col">
                <div class="panel">
                    <div class="panel-title">User Actions (Total: ~2 Minutes)</div>
                    
                    <div class="timeline">
                        <div class="timeline-step">
                            <div class="timeline-marker active">1</div>
                            <div class="step-title">Navigate to Cloud Marketplace</div>
                            <div class="step-detail">
                                Open AWS Marketplace, search "CIQ Secure Stack"<br>
                                Click product listing
                            </div>
                            <div class="step-time">30 seconds</div>
                        </div>
                        
                        <div class="timeline-step">
                            <div class="timeline-marker active">2</div>
                            <div class="step-title">Configure Deployment</div>
                            <div class="step-detail">
                                <strong>Input 1:</strong> Cluster name (e.g., "production-cluster")<br>
                                <strong>Input 2:</strong> Instance size (select from dropdown)<br>
                                <strong>Input 3:</strong> SSH key pair (select existing)
                            </div>
                            <div class="step-time">60 seconds</div>
                        </div>
                        
                        <div class="timeline-step">
                            <div class="timeline-marker active">3</div>
                            <div class="step-title">Launch Stack</div>
                            <div class="step-detail">
                                Click "Launch CloudFormation Stack"<br>
                                Accept default VPC/subnet settings<br>
                                Acknowledge IAM capabilities<br>
                                Click "Create Stack"
                            </div>
                            <div class="step-time">30 seconds</div>
                        </div>
                        
                        <div class="timeline-step">
                            <div class="timeline-marker">4</div>
                            <div class="step-title">Wait for Automation</div>
                            <div class="step-detail">
                                Watch CloudFormation events stream<br>
                                Status: CREATE_IN_PROGRESS<br>
                                <em>No user action required</em>
                            </div>
                            <div class="step-time">~15 minutes</div>
                        </div>
                        
                        <div class="timeline-step">
                            <div class="timeline-marker">5</div>
                            <div class="step-title">Access Cluster</div>
                            <div class="step-detail">
                                CloudFormation outputs show:<br>
                                • <strong>Fuzzball API:</strong> https://cluster.ciq.cloud:6443 (for kubectl)<br>
                                • <strong>Fuzzball Dashboard:</strong> https://dashboard.cluster.ciq.cloud (Web UI + Workflow Catalog)<br>
                                • <strong>Ascender Portal:</strong> https://cluster.ciq.cloud:8443 (Compliance + Ops)<br>
                                Download kubeconfig file for CLI access
                            </div>
                            <div class="step-time">30 seconds</div>
                            <div class="step-output">
$ kubectl --kubeconfig=cluster.conf get nodes
NAME        STATUS   ROLES           AGE   VERSION
worker-01   Ready    control-plane   5m    v1.28.0
worker-02   Ready    worker          4m    v1.28.0
worker-03   Ready    worker          4m    v1.28.0
                            </div>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-title">Behind-the-Scenes Automation (15 Minutes)</div>
                    
                    <div class="timeline">
                        <div class="timeline-step">
                            <div class="timeline-marker">1</div>
                            <div class="step-title">Infrastructure Provisioning</div>
                            <div class="step-detail">
                                CloudFormation creates:<br>
                                • VPC with public/private subnets<br>
                                • Security groups (SSH, K8s API, Ascender)<br>
                                • EC2 instances from CIQ AMI<br>
                                • IAM instance profile (EC2, EBS, KMS permissions)<br>
                                • EBS volumes (encrypted)
                            </div>
                            <div class="step-time">2 minutes</div>
                        </div>
                        
                        <div class="timeline-step">
                            <div class="timeline-marker">2</div>
                            <div class="step-title">First Boot Configuration</div>
                            <div class="step-detail">
                                cloud-init reads metadata:<br>
                                • Instance IP, availability zone, region<br>
                                • Calls: /usr/local/bin/ciq-stack-init<br>
                                • Detects AWS, configures IAM integration<br>
                                • Enables LKRG kernel module<br>
                                • Starts rsyslog, auditd, firewalld
                            </div>
                            <div class="step-time">3 minutes</div>
                        </div>
                        
                        <div class="timeline-step">
                            <div class="timeline-marker">3</div>
                            <div class="step-title">Control Plane Startup</div>
                            <div class="step-detail">
                                <strong>Fuzzball:</strong><br>
                                • Start etcd cluster (3 nodes)<br>
                                • Start API server, scheduler, controller manager<br>
                                • Deploy Cilium CNI (eBPF network plugin)<br>
                                • Generate admin certificates<br><br>
                                <strong>Ascender:</strong><br>
                                • Start PostgreSQL, Redis<br>
                                • Start AWX web server and task workers<br>
                                • Discover worker nodes via Fuzzball API<br>
                                • Load pre-built playbooks
                            </div>
                            <div class="step-time">5 minutes</div>
                        </div>
                        
                        <div class="timeline-step">
                            <div class="timeline-marker">4</div>
                            <div class="step-title">Compliance Validation</div>
                            <div class="step-detail">
                                Ascender executes:<br>
                                • OpenSCAP scan all nodes<br>
                                • Parse results (expect 95%+ pass)<br>
                                • Auto-remediate failed controls (Ansible)<br>
                                • Re-scan to confirm 100%<br>
                                • Generate attestation report (XCCDF)
                            </div>
                            <div class="step-time">3 minutes</div>
                        </div>
                        
                        <div class="timeline-step">
                            <div class="timeline-marker">5</div>
                            <div class="step-title">Policy Enforcement</div>
                            <div class="step-detail">
                                Configure security baseline:<br>
                                • Apply deny-all network policies<br>
                                • Enable RBAC with namespace isolation<br>
                                • Configure secret encryption (etcd + KMS)<br>
                                • Set up log forwarding to SIEM<br>
                                • Signal CloudFormation: CREATE_COMPLETE
                            </div>
                            <div class="step-time">2 minutes</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="info-box">
                <div class="info-title">Post-Install State</div>
                <div class="info-text">
                    <strong>Cluster Ready:</strong> 3 worker nodes, Kubernetes API responsive<br>
                    <strong>Compliance:</strong> OpenSCAP scan passed, attestation report available<br>
                    <strong>Access:</strong> kubectl via downloaded kubeconfig, Fuzzball Dashboard for workload visibility and workflow catalog, Ascender Portal at https://cluster-url:8443 for ops<br>
                    <strong>Policies Active:</strong> Network deny-all, RBAC enforced, secrets encrypted, logs forwarding to SIEM<br>
                    <strong>Monitoring:</strong> Ascender scheduled hourly drift detection, Fuzzball health checks running
                </div>
            </div>
        </div>

        <!-- Tab 3: Component Integration -->
        <div id="integration" class="tab-content">
            <div class="section-title">Component Integration Matrix</div>
            
            <div class="integration-grid">
                <!-- Headers -->
                <div class="integration-cell integration-header"></div>
                <div class="integration-cell integration-header">Fuzzball</div>
                <div class="integration-cell integration-header">Ascender</div>
                <div class="integration-cell integration-header">Apptainer</div>
                <div class="integration-cell integration-header">CIQ Registry</div>
                
                <!-- Fuzzball Row -->
                <div class="integration-cell integration-label">Fuzzball</div>
                <div class="integration-cell">—</div>
                <div class="integration-cell integration-active">
                    <div>API Client</div>
                    <span class="protocol-badge">HTTPS REST</span>
                    <small style="display: block; margin-top: 6px;">Ascender deploys manifests, queries state</small>
                </div>
                <div class="integration-cell integration-active">
                    <div>CRI Socket</div>
                    <span class="protocol-badge">gRPC</span>
                    <small style="display: block; margin-top: 6px;">Kubelet calls container operations</small>
                </div>
                <div class="integration-cell">
                    <small>No direct connection</small>
                </div>
                
                <!-- Ascender Row -->
                <div class="integration-cell integration-label">Ascender</div>
                <div class="integration-cell integration-active">
                    <div>K8s Client</div>
                    <span class="protocol-badge">HTTPS</span>
                    <small style="display: block; margin-top: 6px;">Deploy manifests, drain nodes</small>
                </div>
                <div class="integration-cell">—</div>
                <div class="integration-cell">
                    <small>No direct connection</small>
                </div>
                <div class="integration-cell">
                    <small>No direct connection</small>
                </div>
                
                <!-- Apptainer Row -->
                <div class="integration-cell integration-label">Apptainer</div>
                <div class="integration-cell integration-active">
                    <div>CRI Interface</div>
                    <span class="protocol-badge">gRPC</span>
                    <small style="display: block; margin-top: 6px;">Receive pod assignments</small>
                </div>
                <div class="integration-cell">
                    <small>No direct connection</small>
                </div>
                <div class="integration-cell">—</div>
                <div class="integration-cell integration-active">
                    <div>Image Pull</div>
                    <span class="protocol-badge">HTTPS</span>
                    <small style="display: block; margin-top: 6px;">Download + GPG verify</small>
                </div>
                
                <!-- RLC-H Row -->
                <div class="integration-cell integration-label">RLC-H Nodes</div>
                <div class="integration-cell integration-active">
                    <div>kubelet agent</div>
                    <span class="protocol-badge">HTTPS</span>
                    <small style="display: block; margin-top: 6px;">Node registration, heartbeat</small>
                </div>
                <div class="integration-cell integration-active">
                    <div>Ansible Target</div>
                    <span class="protocol-badge">SSH</span>
                    <small style="display: block; margin-top: 6px;">Configuration management</small>
                </div>
                <div class="integration-cell integration-active">
                    <div>Host OS</div>
                    <span class="protocol-badge">Local</span>
                    <small style="display: block; margin-top: 6px;">Provides FIPS, SELinux, kernel</small>
                </div>
                <div class="integration-cell">
                    <small>No direct connection</small>
                </div>
            </div>

            <div class="section-title">Integration Protocols Explained</div>
            
            <div class="grid-2col">
                <div class="panel">
                    <div class="panel-title">Fuzzball ↔ Apptainer (CRI Socket)</div>
                    <div class="component-features">
                        <div><strong>Protocol:</strong> gRPC over Unix socket</div>
                        <div><strong>Socket Path:</strong> /var/run/apptainer/apptainer.sock</div>
                        <div><strong>Standard:</strong> Kubernetes Container Runtime Interface (CRI v1alpha2)</div>
                        <div><strong>Operations:</strong> RunPodSandbox, CreateContainer, StartContainer, StopContainer, RemoveContainer</div>
                        <div><strong>Data Flow:</strong> Kubelet → Apptainer CRI shim → Apptainer binary</div>
                    </div>
                    <div class="code-block" style="font-size: 10px;">
// Kubelet calls CRI
RunPodSandbox(podName, namespace)
  → Apptainer creates network namespace

CreateContainer(image, mounts, env)
  → Apptainer pulls image from registry
  → Verifies GPG signature
  → Converts OCI → SIF format

StartContainer(containerID)
  → apptainer instance start
  → Returns container PID
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-title">Ascender ↔ Fuzzball (K8s API)</div>
                    <div class="component-features">
                        <div><strong>Protocol:</strong> HTTPS REST API</div>
                        <div><strong>Endpoint:</strong> https://fuzzball-api:6443</div>
                        <div><strong>Authentication:</strong> Client certificate (ascender-automation.crt)</div>
                        <div><strong>Operations:</strong> Apply manifests, query resources, drain/cordon nodes</div>
                        <div><strong>Use Cases:</strong> Automated deployments, pre-patch node draining, compliance validation</div>
                    </div>
                    <div class="code-block" style="font-size: 10px;">
# Ascender Ansible playbook
- name: Deploy to Fuzzball
  k8s:
    state: present
    definition: "{{ manifest }}"
    kubeconfig: /etc/ansible/kubeconfig
    
# Before OS patch
- name: Drain node
  command: kubectl drain worker-01
           --ignore-daemonsets
           --kubeconfig=/etc/ansible/kubeconfig
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-title">Ascender ↔ RLC-H (SSH + Ansible)</div>
                    <div class="component-features">
                        <div><strong>Protocol:</strong> SSH with certificate-based authentication</div>
                        <div><strong>Port:</strong> 22 (SSH)</div>
                        <div><strong>Authentication:</strong> SSH certificates (no passwords)</div>
                        <div><strong>Operations:</strong> Run Ansible playbooks, gather facts, execute commands</div>
                        <div><strong>Frequency:</strong> Hourly drift checks, monthly patches</div>
                    </div>
                    <div class="code-block" style="font-size: 10px;">
# Ansible inventory (auto-discovered)
[workers]
worker-01 ansible_host=10.0.1.10
worker-02 ansible_host=10.0.1.11
worker-03 ansible_host=10.0.1.12

# Drift detection playbook
- name: Check SSH config
  command: cat /etc/ssh/sshd_config
  register: current_config
  
- name: Compare with baseline
  assert:
    that: current_config.stdout == baseline
    fail_msg: "Drift detected"
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-title">Apptainer ↔ CIQ Registry (Image Pull)</div>
                    <div class="component-features">
                        <div><strong>Protocol:</strong> HTTPS with TLS 1.3</div>
                        <div><strong>Endpoint:</strong> registry.ciq.com</div>
                        <div><strong>Authentication:</strong> OAuth2 bearer token</div>
                        <div><strong>Verification:</strong> GPG signature on all images</div>
                        <div><strong>Operations:</strong> Pull image, verify signature, cache locally</div>
                    </div>
                    <div class="code-block" style="font-size: 10px;">
# Image pull flow
1. Request token from registry
   GET /token?scope=repository:rlc-h-python:pull
   
2. Download manifest
   GET /v2/rlc-h-python/manifests/9.5
   Headers: Authorization: Bearer {token}
   
3. Download layers
   GET /v2/rlc-h-python/blobs/sha256:{digest}
   
4. Download signature
   GET /v2/rlc-h-python/signatures/sha256:{digest}
   
5. Verify GPG
   gpg --verify signature.asc image.tar.gz
   Using CIQ public key from /etc/apptainer/keys/
                    </div>
                </div>
            </div>

            <div class="section-title">Multi-Cloud Abstraction: How cloud-init + Fuzzball Enable Portability</div>
            
            <div class="panel">
                <div class="panel-title">Cloud Detection and Configuration</div>
                
                <div class="code-block">
# cloud-init executes on first boot (ALL clouds support this)

#!/bin/bash
# /usr/local/bin/ciq-stack-init

# Detect cloud provider via metadata service
if curl -s -m 2 http://169.254.169.254/latest/meta-data/ >/dev/null 2>&1; then
    CLOUD="aws"
    INSTANCE_ID=$(curl -s http://169.254.169.254/latest/meta-data/instance-id)
    REGION=$(curl -s http://169.254.169.254/latest/meta-data/placement/region)
    
elif curl -s -m 2 -H "Metadata:true" http://169.254.169.254/metadata/instance >/dev/null 2>&1; then
    CLOUD="azure"
    INSTANCE_ID=$(curl -s -H "Metadata:true" http://169.254.169.254/metadata/instance/compute/vmId)
    REGION=$(curl -s -H "Metadata:true" http://169.254.169.254/metadata/instance/compute/location)
    
elif curl -s -m 2 -H "Metadata-Flavor: Google" http://metadata.google.internal/ >/dev/null 2>&1; then
    CLOUD="gcp"
    INSTANCE_ID=$(curl -s -H "Metadata-Flavor: Google" http://metadata.google.internal/computeMetadata/v1/instance/id)
    REGION=$(curl -s -H "Metadata-Flavor: Google" http://metadata.google.internal/computeMetadata/v1/instance/zone)
    
else
    CLOUD="baremetal"
fi

# Load cloud-specific Fuzzball config
case $CLOUD in
    aws)
        # Enable AWS cloud controller manager
        systemctl enable --now fuzzball-cloud-controller-aws
        # Configure EBS CSI driver
        kubectl apply -f /etc/fuzzball/aws-ebs-csi-driver.yaml
        ;;
    azure)
        systemctl enable --now fuzzball-cloud-controller-azure
        kubectl apply -f /etc/fuzzball/azure-disk-csi-driver.yaml
        ;;
    gcp)
        systemctl enable --now fuzzball-cloud-controller-gcp
        kubectl apply -f /etc/fuzzball/gce-pd-csi-driver.yaml
        ;;
esac

# Start control planes
systemctl start fuzzball-apiserver fuzzball-controller-manager fuzzball-scheduler
systemctl start ascender-web ascender-task

# Run initial compliance scan
ansible-playbook /etc/ascender/playbooks/initial-stig-scan.yml
                </div>
            </div>

            <div class="section-title">Storage Abstraction Example</div>
            
            <div class="code-block">
# User writes this ONCE (cloud-agnostic Kubernetes)
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: database-storage
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 100Gi
  storageClassName: ssd

---
# What happens on AWS:
Fuzzball cloud controller → AWS API: CreateVolume(Size=100GB, Type=gp3, Encrypted=true)
→ Attach to EC2 instance
→ Mount at /var/lib/kubelet/pods/{pod-id}/volumes/

# What happens on Azure:
Fuzzball cloud controller → Azure API: CreateManagedDisk(Size=100GB, SKU=Premium_LRS)
→ Attach to VM
→ Mount at /var/lib/kubelet/pods/{pod-id}/volumes/

# What happens on GCP:
Fuzzball cloud controller → GCP API: CreateDisk(Size=100GB, Type=pd-ssd)
→ Attach to instance
→ Mount at /var/lib/kubelet/pods/{pod-id}/volumes/

# User sees: Same PVC, same mount path, works identically across clouds
                </div>
        </div>

        <!-- Technical Specifications -->
        <div class="section-title" style="margin-top: 60px;">Technical Specifications Summary</div>
        
        <div class="grid-2col">
            <div class="panel">
                <div class="panel-title">Fuzzball Technical Specs</div>
                <div class="component-features">
                    <div><strong>API Version:</strong> Kubernetes v1.28+</div>
                    <div><strong>etcd:</strong> 3-node cluster, encrypted at rest (AES-GCM-256)</div>
                    <div><strong>Network Plugin:</strong> Cilium (eBPF-based)</div>
                    <div><strong>Secret Encryption:</strong> etcd encryption + external KMS integration</div>
                    <div><strong>RBAC:</strong> Namespace isolation, service accounts, role bindings</div>
                    <div><strong>Audit:</strong> All API calls logged (metadata + request/response)</div>
                    <div><strong>Cloud Controllers:</strong> AWS (EBS, ELB), Azure (Disk, LB), GCP (PD, LB)</div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-title">Ascender Pro Technical Specs</div>
                <div class="component-features">
                    <div><strong>Based On:</strong> AWX (Ansible Tower open-source)</div>
                    <div><strong>Database:</strong> PostgreSQL 13+ (encrypted credentials)</div>
                    <div><strong>Task Queue:</strong> Redis + Celery workers</div>
                    <div><strong>Execution:</strong> Ansible Runner in isolated containers</div>
                    <div><strong>Compliance Scanner:</strong> OpenSCAP (RHEL 9 STIG v2r1)</div>
                    <div><strong>Scan Frequency:</strong> Hourly drift detection</div>
                    <div><strong>Auto-Remediation:</strong> Failed controls fixed in <60 minutes</div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-title">Apptainer Technical Specs</div>
                <div class="component-features">
                    <div><strong>Binary:</strong> /usr/bin/apptainer (rootless mode)</div>
                    <div><strong>CRI Socket:</strong> /var/run/apptainer/apptainer.sock</div>
                    <div><strong>Image Formats:</strong> SIF (native), OCI (compatible)</div>
                    <div><strong>Isolation:</strong> Namespaces (PID, network, mount, UTS, IPC)</div>
                    <div><strong>Security:</strong> SELinux context (container_t), no setuid</div>
                    <div><strong>Resource Limits:</strong> cgroup v2 for CPU, memory, I/O</div>
                    <div><strong>FIPS Mode:</strong> Inherits host cryptography</div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-title">RLC-H Base OS Technical Specs</div>
                <div class="component-features">
                    <div><strong>Kernel:</strong> Rocky Linux 9.x (6.x series)</div>
                    <div><strong>LKRG:</strong> Openwall kernel module, integrity checks</div>
                    <div><strong>SELinux:</strong> Enforcing mode, targeted policy</div>
                    <div><strong>FIPS:</strong> Kernel crypto, OpenSSL 3.x, NSS (validated)</div>
                    <div><strong>Audit:</strong> auditd with 50+ rules, rsyslog forwarding</div>
                    <div><strong>Firewall:</strong> firewalld with default deny</div>
                    <div><strong>Compliance:</strong> OpenSCAP scanner, 284 STIG controls</div>
                </div>
            </div>
        </div>

        <div class="section-title">Multi-Cloud Resource Mapping</div>
        
        <div class="panel">
            <div class="panel-title">Kubernetes Primitive → Cloud Resource Translation</div>
            <div class="integration-grid" style="margin-top: 20px;">
                <div class="integration-cell integration-header">K8s Resource</div>
                <div class="integration-cell integration-header">AWS</div>
                <div class="integration-cell integration-header">Azure</div>
                <div class="integration-cell integration-header">GCP</div>
                <div class="integration-cell integration-header">On-Premises</div>
                
                <div class="integration-cell integration-label">PersistentVolume</div>
                <div class="integration-cell">EBS Volume<br>(gp3, io2)</div>
                <div class="integration-cell">Managed Disk<br>(Premium SSD)</div>
                <div class="integration-cell">Persistent Disk<br>(SSD)</div>
                <div class="integration-cell">Local storage<br>(LVM, Ceph)</div>
                
                <div class="integration-cell integration-label">LoadBalancer</div>
                <div class="integration-cell">ALB / NLB<br>(Layer 7/4)</div>
                <div class="integration-cell">Azure LB<br>(Standard SKU)</div>
                <div class="integration-cell">Cloud LB<br>(TCP/UDP)</div>
                <div class="integration-cell">MetalLB<br>(BGP/ARP)</div>
                
                <div class="integration-cell integration-label">StorageClass</div>
                <div class="integration-cell">ebs-csi-driver<br>provisioner</div>
                <div class="integration-cell">azuredisk-csi<br>provisioner</div>
                <div class="integration-cell">gce-pd-csi<br>provisioner</div>
                <div class="integration-cell">local-path<br>provisioner</div>
                
                <div class="integration-cell integration-label">Node Identity</div>
                <div class="integration-cell">IAM Instance<br>Profile</div>
                <div class="integration-cell">Managed<br>Identity</div>
                <div class="integration-cell">Service<br>Account</div>
                <div class="integration-cell">SSH keys /<br>certificates</div>
            </div>
        </div>

        <div class="info-box">
            <div class="info-title">Key Architectural Decisions</div>
            <div class="info-text">
                <strong>Two Control Planes:</strong> Separates workload lifecycle (Fuzzball) from infrastructure lifecycle (Ascender) to prevent app deployments from affecting OS compliance state.<br><br>
                <strong>Apptainer over Docker:</strong> Rootless operation eliminates daemon privilege escalation risk. Native FIPS mode and SELinux integration required for regulated workloads.<br><br>
                <strong>cloud-init Portability:</strong> Universal first-boot script supported by all major clouds enables same AMI/image to work on AWS, Azure, GCP with cloud-specific adaptation at runtime.<br><br>
                <strong>CSI Driver Pattern:</strong> Out-of-tree storage drivers allow Fuzzball to remain cloud-agnostic while supporting cloud-native storage features (snapshots, encryption, performance tiers).
            </div>
        </div>
    </div>

    <script>
        function showTab(tabName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            
            // Show selected tab
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }
    </script>
</body>
</html>
