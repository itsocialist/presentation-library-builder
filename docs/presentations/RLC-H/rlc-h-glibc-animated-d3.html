<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RLC-H Hardened glibc - Animated Memory Protection</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0d1117;
            --bg-card: #161b22;
            --bg-elevated: #21262d;
            --accent-teal: #00d4aa;
            --accent-red: #f85149;
            --accent-orange: #d29922;
            --accent-blue: #58a6ff;
            --accent-purple: #a371f7;
            --accent-green: #3fb950;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --border: #30363d;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            padding: 8px 16px;
            border-radius: 20px;
            margin-bottom: 16px;
        }
        
        .badge-text {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            font-weight: 600;
            color: var(--accent-teal);
            letter-spacing: 1px;
        }
        
        h1 {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 12px;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-teal) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .subtitle {
            font-size: 16px;
            color: var(--text-secondary);
            max-width: 700px;
            margin: 0 auto;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
        }
        
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .feature-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .feature-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--accent-teal);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .feature-card:hover, .feature-card.active {
            border-color: var(--accent-teal);
            transform: translateX(4px);
        }
        
        .feature-card:hover::before, .feature-card.active::before {
            opacity: 1;
        }
        
        .feature-icon {
            font-size: 20px;
            margin-bottom: 8px;
        }
        
        .feature-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 6px;
        }
        
        .feature-desc {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        
        .visualization-panel {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            min-height: 700px;
        }
        
        .viz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }
        
        .viz-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .controls {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .btn:hover {
            background: var(--border);
        }
        
        .btn.primary {
            background: var(--accent-teal);
            border-color: var(--accent-teal);
            color: var(--bg-dark);
        }
        
        .btn.primary:hover {
            background: #00b894;
        }
        
        .btn.danger {
            background: rgba(248, 81, 73, 0.15);
            border-color: var(--accent-red);
            color: var(--accent-red);
        }
        
        .btn.danger:hover {
            background: rgba(248, 81, 73, 0.25);
        }
        
        #memory-viz {
            width: 100%;
        }
        
        .legend {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .legend-dot {
            width: 14px;
            height: 14px;
            border-radius: 3px;
        }
        
        .attack-log {
            margin-top: 20px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .log-entry {
            padding: 4px 0;
            border-bottom: 1px solid var(--border);
            display: flex;
            gap: 10px;
        }
        
        .log-entry:last-child {
            border-bottom: none;
        }
        
        .log-time {
            color: var(--text-secondary);
            min-width: 80px;
        }
        
        .log-message {
            flex: 1;
        }
        
        .log-message.success {
            color: var(--accent-green);
        }
        
        .log-message.blocked {
            color: var(--accent-red);
        }
        
        .log-message.warning {
            color: var(--accent-orange);
        }
        
        .log-message.info {
            color: var(--accent-blue);
        }
        
        .status-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-badge.protected {
            background: rgba(0, 212, 170, 0.15);
            color: var(--accent-teal);
            border: 1px solid var(--accent-teal);
        }
        
        .status-badge.attack {
            background: rgba(248, 81, 73, 0.15);
            color: var(--accent-red);
            border: 1px solid var(--accent-red);
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
        }
        
        .tooltip {
            position: absolute;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 13px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 1000;
            max-width: 300px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
        }
        
        .tooltip-title {
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--accent-teal);
        }
        
        .tooltip-content {
            color: var(--text-secondary);
            line-height: 1.5;
        }
        
        .packet {
            pointer-events: none;
        }
        
        .comparison-section {
            margin-top: 30px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .comparison-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
        }
        
        .comparison-card.vulnerable {
            border-color: rgba(248, 81, 73, 0.3);
        }
        
        .comparison-card.protected {
            border-color: rgba(0, 212, 170, 0.3);
        }
        
        .comparison-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .comparison-badge {
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .comparison-badge.vulnerable {
            background: rgba(248, 81, 73, 0.15);
            color: var(--accent-red);
        }
        
        .comparison-badge.protected {
            background: rgba(0, 212, 170, 0.15);
            color: var(--accent-teal);
        }
        
        .env-vars-stripped {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 12px;
        }
        
        .env-var {
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            padding: 4px 8px;
            background: var(--bg-dark);
            border-radius: 4px;
            color: var(--accent-red);
            text-decoration: line-through;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="badge">
                <span class="badge-text">RLC-H</span>
                <span style="color: var(--text-secondary);">‚Ä¢</span>
                <span style="color: var(--text-secondary); font-size: 11px;">Rocky Linux Hardened</span>
            </div>
            <h1>Hardened glibc Memory Protection</h1>
            <p class="subtitle">Interactive visualization of proactive memory security through environment sanitization and hardened function implementations</p>
        </div>
        
        <div class="main-content">
            <div class="sidebar">
                <div class="feature-card active" data-feature="env-sanitization">
                    <div class="feature-icon">üõ°Ô∏è</div>
                    <div class="feature-title">Environment Sanitization</div>
                    <div class="feature-desc">Strips dangerous env vars at privilege boundaries before parsing</div>
                </div>
                
                <div class="feature-card" data-feature="syslog-hardening">
                    <div class="feature-icon">üìù</div>
                    <div class="feature-title">Hardened syslog()</div>
                    <div class="feature-desc">Validates __progname in SUID context, prevents heap overflow</div>
                </div>
                
                <div class="feature-card" data-feature="overflow-checks">
                    <div class="feature-icon">üî¢</div>
                    <div class="feature-title">Integer Overflow Protection</div>
                    <div class="feature-desc">fread/fwrite check for size √ó nmemb overflow conditions</div>
                </div>
                
                <div class="feature-card" data-feature="safe-asprintf">
                    <div class="feature-icon">üîÑ</div>
                    <div class="feature-title">Safe asprintf()</div>
                    <div class="feature-desc">Resets pointer to NULL on error (BSD behavior)</div>
                </div>
                
                <div class="feature-card" data-feature="robust-qsort">
                    <div class="feature-icon">üìä</div>
                    <div class="feature-title">Robust qsort()</div>
                    <div class="feature-desc">Handles nontransitive comparators without memory corruption</div>
                </div>
            </div>
            
            <div class="visualization-panel" style="position: relative;">
                <div class="status-badge protected" id="status-badge">
                    <div class="status-dot"></div>
                    <span>PROTECTED</span>
                </div>
                
                <div class="viz-header">
                    <div class="viz-title">SUID Program Memory Space</div>
                    <div class="controls">
                        <button class="btn" id="btn-reset">
                            <span>‚Üª</span> Reset
                        </button>
                        <button class="btn danger" id="btn-attack">
                            <span>‚ö°</span> Simulate CVE-2023-4911
                        </button>
                    </div>
                </div>
                
                <div id="memory-viz"></div>
                
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-dot" style="background: var(--accent-teal);"></div>
                        <span>Protected Data</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: var(--accent-red);"></div>
                        <span>Sanitized/Blocked</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: var(--accent-purple);"></div>
                        <span>glibc Hardened</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: var(--accent-orange);"></div>
                        <span>Canary Values</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: var(--bg-elevated); border: 1px solid var(--border);"></div>
                        <span>User Data</span>
                    </div>
                </div>
                
                <div class="attack-log" id="attack-log">
                    <div class="log-entry">
                        <span class="log-time">[00:00:00]</span>
                        <span class="log-message info">System initialized with RLC-H hardened glibc</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="comparison-section">
            <div class="comparison-card vulnerable">
                <div class="comparison-header">
                    <div class="comparison-badge vulnerable">Vulnerable</div>
                    <span style="font-weight: 600;">Standard glibc</span>
                </div>
                <div id="standard-flow"></div>
            </div>
            
            <div class="comparison-card protected">
                <div class="comparison-header">
                    <div class="comparison-badge protected">Protected</div>
                    <span style="font-weight: 600;">RLC-H Hardened glibc</span>
                </div>
                <div id="hardened-flow"></div>
            </div>
        </div>
    </div>
    
    <div class="tooltip" id="tooltip"></div>
    
    <script>
        // Configuration
        const config = {
            width: 800,
            height: 450,
            margin: { top: 30, right: 40, bottom: 30, left: 100 },
            colors: {
                protected: '#00d4aa',
                blocked: '#f85149',
                hardened: '#a371f7',
                canary: '#d29922',
                data: '#21262d',
                kernel: '#30363d',
                text: '#e6edf3',
                textSecondary: '#8b949e'
            }
        };
        
        const innerWidth = config.width - config.margin.left - config.margin.right;
        const innerHeight = config.height - config.margin.top - config.margin.bottom;
        
        // Memory regions data
        const memoryRegions = [
            { 
                name: 'Kernel Space', 
                address: '0xFFFF...', 
                type: 'kernel',
                blocks: [
                    { name: 'KERNEL', type: 'kernel', width: 1, tooltip: 'Kernel memory space - inaccessible to userspace' }
                ]
            },
            { 
                name: 'Stack (SANITIZED)', 
                address: 'Stack ‚Üì', 
                type: 'stack',
                blocks: [
                    { name: 'STRIP', type: 'blocked', width: 0.15, tooltip: 'Environment variables stripped at privilege boundary' },
                    { name: 'argv', type: 'protected', width: 0.2, tooltip: 'Program arguments (sanitized)' },
                    { name: 'envp', type: 'protected', width: 0.2, tooltip: 'Environment pointer (dangerous vars removed)' },
                    { name: 'locals', type: 'data', width: 0.2, tooltip: 'Local variables' },
                    { name: 'frames', type: 'data', width: 0.25, tooltip: 'Stack frames' }
                ]
            },
            { 
                name: '‚Üï Growth', 
                address: '', 
                type: 'gap',
                blocks: [
                    { name: '', type: 'gap', width: 1, tooltip: '' }
                ]
            },
            { 
                name: 'Heap (PROTECTED)', 
                address: 'Heap ‚Üë', 
                type: 'heap',
                blocks: [
                    { name: 'META', type: 'hardened', width: 0.15, tooltip: 'Separated metadata - protected from corruption' },
                    { name: 'alloc', type: 'protected', width: 0.2, tooltip: 'User allocation with overflow protection' },
                    { name: 'üî∂', type: 'canary', width: 0.1, tooltip: 'Canary value - 56-bit random number checks on free()' },
                    { name: '__prog', type: 'hardened', width: 0.15, tooltip: '__progname validated by hardened syslog()' },
                    { name: 'data', type: 'protected', width: 0.2, tooltip: 'Protected heap data' },
                    { name: 'üî∂', type: 'canary', width: 0.1, tooltip: 'Canary value for overflow detection' },
                    { name: 'GUARD', type: 'blocked', width: 0.1, tooltip: 'Guard page - SIGSEGV on access' }
                ]
            },
            { 
                name: 'BSS Segment', 
                address: 'BSS', 
                type: 'bss',
                blocks: [
                    { name: 'uninit globals', type: 'data', width: 0.6, tooltip: 'Uninitialized global variables' },
                    { name: 'CHECK', type: 'hardened', width: 0.4, tooltip: 'Integer overflow checks active' }
                ]
            },
            { 
                name: 'Data Segment', 
                address: 'Data', 
                type: 'data-seg',
                blocks: [
                    { name: 'init globals', type: 'data', width: 0.7, tooltip: 'Initialized global variables' },
                    { name: 'glibc', type: 'hardened', width: 0.3, tooltip: 'Hardened glibc data structures' }
                ]
            },
            { 
                name: 'Text Segment', 
                address: 'Text', 
                type: 'text',
                blocks: [
                    { name: 'HARDENED GLIBC + PROGRAM CODE (Read-Only)', type: 'hardened', width: 1, tooltip: 'Executable code including hardened glibc' }
                ]
            },
            { 
                name: 'Reserved', 
                address: '0x0000...', 
                type: 'reserved',
                blocks: [
                    { name: 'NULL GUARD', type: 'blocked', width: 1, tooltip: 'NULL pointer dereference protection' }
                ]
            }
        ];
        
        // Create SVG
        const svg = d3.select('#memory-viz')
            .append('svg')
            .attr('viewBox', `0 0 ${config.width} ${config.height}`)
            .attr('preserveAspectRatio', 'xMidYMid meet')
            .style('max-width', '100%')
            .style('height', 'auto');
        
        const g = svg.append('g')
            .attr('transform', `translate(${config.margin.left}, ${config.margin.top})`);
        
        // Tooltip
        const tooltip = d3.select('#tooltip');
        
        // Scales
        const yScale = d3.scaleBand()
            .domain(memoryRegions.map(d => d.name))
            .range([0, innerHeight])
            .padding(0.15);
        
        // Draw memory regions
        function drawMemoryVisualization() {
            const regionGroups = g.selectAll('.region-group')
                .data(memoryRegions)
                .enter()
                .append('g')
                .attr('class', 'region-group')
                .attr('transform', d => `translate(0, ${yScale(d.name)})`);
            
            // Address labels
            regionGroups.append('text')
                .attr('x', -10)
                .attr('y', yScale.bandwidth() / 2)
                .attr('text-anchor', 'end')
                .attr('dominant-baseline', 'middle')
                .style('font-family', "'JetBrains Mono', monospace")
                .style('font-size', '11px')
                .style('fill', config.colors.textSecondary)
                .text(d => d.address);
            
            // Memory blocks
            regionGroups.each(function(region) {
                const group = d3.select(this);
                let xOffset = 0;
                
                region.blocks.forEach((block, i) => {
                    const blockWidth = block.width * innerWidth;
                    
                    if (block.type !== 'gap') {
                        const rect = group.append('rect')
                            .attr('class', `memory-block block-${block.type}`)
                            .attr('x', xOffset)
                            .attr('y', 0)
                            .attr('width', 0)
                            .attr('height', yScale.bandwidth())
                            .attr('rx', 4)
                            .attr('fill', getBlockColor(block.type))
                            .attr('stroke', block.type === 'data' ? config.colors.textSecondary : 'none')
                            .attr('stroke-width', block.type === 'data' ? 1 : 0)
                            .attr('stroke-opacity', 0.3)
                            .style('cursor', 'pointer')
                            .on('mouseover', function(event) {
                                if (block.tooltip) {
                                    d3.select(this)
                                        .transition()
                                        .duration(200)
                                        .attr('filter', 'brightness(1.2)');
                                    
                                    tooltip
                                        .style('opacity', 1)
                                        .html(`
                                            <div class="tooltip-title">${block.name || region.name}</div>
                                            <div class="tooltip-content">${block.tooltip}</div>
                                        `)
                                        .style('left', (event.pageX + 15) + 'px')
                                        .style('top', (event.pageY - 15) + 'px');
                                }
                            })
                            .on('mouseout', function() {
                                d3.select(this)
                                    .transition()
                                    .duration(200)
                                    .attr('filter', 'none');
                                tooltip.style('opacity', 0);
                            });
                        
                        // Animate in
                        rect.transition()
                            .duration(800)
                            .delay(i * 50 + memoryRegions.indexOf(region) * 100)
                            .attr('width', blockWidth - 2);
                        
                        // Block label
                        if (block.name && block.width > 0.08) {
                            group.append('text')
                                .attr('class', 'block-label')
                                .attr('x', xOffset + blockWidth / 2)
                                .attr('y', yScale.bandwidth() / 2)
                                .attr('text-anchor', 'middle')
                                .attr('dominant-baseline', 'middle')
                                .style('font-family', "'JetBrains Mono', monospace")
                                .style('font-size', block.width < 0.15 ? '9px' : '10px')
                                .style('font-weight', '600')
                                .style('fill', getTextColor(block.type))
                                .style('pointer-events', 'none')
                                .style('opacity', 0)
                                .text(block.name)
                                .transition()
                                .duration(400)
                                .delay(800 + i * 50 + memoryRegions.indexOf(region) * 100)
                                .style('opacity', 1);
                        }
                    }
                    
                    xOffset += blockWidth;
                });
            });
            
            // Region labels on the right
            regionGroups.append('text')
                .attr('x', innerWidth + 10)
                .attr('y', yScale.bandwidth() / 2)
                .attr('dominant-baseline', 'middle')
                .style('font-size', '12px')
                .style('fill', d => d.type === 'gap' ? config.colors.textSecondary : config.colors.text)
                .style('font-style', d => d.type === 'gap' ? 'italic' : 'normal')
                .style('opacity', d => d.type === 'gap' ? 0.5 : 1)
                .text(d => d.name);
        }
        
        function getBlockColor(type) {
            const colors = {
                'protected': config.colors.protected,
                'blocked': config.colors.blocked,
                'hardened': config.colors.hardened,
                'canary': config.colors.canary,
                'data': config.colors.data,
                'kernel': config.colors.kernel,
                'gap': 'transparent'
            };
            return colors[type] || config.colors.data;
        }
        
        function getTextColor(type) {
            if (type === 'data') return config.colors.textSecondary;
            if (type === 'kernel') return config.colors.textSecondary;
            return '#fff';
        }
        
        // Attack simulation
        let isAttacking = false;
        
        function simulateAttack() {
            if (isAttacking) return;
            isAttacking = true;
            
            const statusBadge = document.getElementById('status-badge');
            statusBadge.className = 'status-badge attack';
            statusBadge.innerHTML = '<div class="status-dot"></div><span>ATTACK IN PROGRESS</span>';
            
            addLog('warning', 'Attacker sets GLIBC_TUNABLES="name=name=val" (malformed)');
            
            // Create attack packet
            const packet = g.append('g')
                .attr('class', 'packet')
                .attr('transform', `translate(-50, ${yScale('Stack (SANITIZED)') + yScale.bandwidth() / 2})`);
            
            packet.append('rect')
                .attr('width', 40)
                .attr('height', 20)
                .attr('rx', 4)
                .attr('fill', config.colors.blocked)
                .attr('opacity', 0.9);
            
            packet.append('text')
                .attr('x', 20)
                .attr('y', 12)
                .attr('text-anchor', 'middle')
                .style('font-size', '8px')
                .style('font-weight', '600')
                .style('fill', '#fff')
                .text('TUNABLES');
            
            // Animate attack
            setTimeout(() => {
                addLog('info', 'Executing SUID binary /usr/bin/passwd...');
            }, 500);
            
            packet.transition()
                .duration(1500)
                .attr('transform', `translate(${innerWidth * 0.05}, ${yScale('Stack (SANITIZED)') + yScale.bandwidth() / 2 - 10})`)
                .on('end', function() {
                    addLog('blocked', '‚õî RLC-H: GLIBC_TUNABLES stripped BEFORE ld.so parsing');
                    
                    // Flash the STRIP block
                    g.selectAll('.block-blocked')
                        .transition()
                        .duration(200)
                        .attr('fill', '#fff')
                        .transition()
                        .duration(200)
                        .attr('fill', config.colors.blocked)
                        .transition()
                        .duration(200)
                        .attr('fill', '#fff')
                        .transition()
                        .duration(200)
                        .attr('fill', config.colors.blocked);
                    
                    // Packet blocked animation
                    packet.transition()
                        .duration(300)
                        .attr('transform', `translate(${innerWidth * 0.05}, ${yScale('Stack (SANITIZED)') + yScale.bandwidth() / 2 - 10}) scale(1.5)`)
                        .style('opacity', 0)
                        .remove();
                    
                    // Add X mark
                    const xMark = g.append('text')
                        .attr('x', innerWidth * 0.08)
                        .attr('y', yScale('Stack (SANITIZED)') + yScale.bandwidth() / 2)
                        .attr('text-anchor', 'middle')
                        .attr('dominant-baseline', 'middle')
                        .style('font-size', '24px')
                        .style('fill', config.colors.blocked)
                        .style('opacity', 0)
                        .text('‚úó');
                    
                    xMark.transition()
                        .duration(300)
                        .style('opacity', 1)
                        .transition()
                        .delay(2000)
                        .duration(500)
                        .style('opacity', 0)
                        .remove();
                    
                    setTimeout(() => {
                        addLog('success', '‚úì Buffer overflow prevented - no privilege escalation');
                        addLog('success', '‚úì Process continues safely with sanitized environment');
                        
                        statusBadge.className = 'status-badge protected';
                        statusBadge.innerHTML = '<div class="status-dot"></div><span>ATTACK BLOCKED</span>';
                        
                        setTimeout(() => {
                            statusBadge.innerHTML = '<div class="status-dot"></div><span>PROTECTED</span>';
                            isAttacking = false;
                        }, 3000);
                    }, 500);
                });
        }
        
        function addLog(type, message) {
            const log = document.getElementById('attack-log');
            const time = new Date().toLocaleTimeString('en-US', { hour12: false });
            
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `
                <span class="log-time">[${time}]</span>
                <span class="log-message ${type}">${message}</span>
            `;
            
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }
        
        function resetVisualization() {
            const statusBadge = document.getElementById('status-badge');
            statusBadge.className = 'status-badge protected';
            statusBadge.innerHTML = '<div class="status-dot"></div><span>PROTECTED</span>';
            
            document.getElementById('attack-log').innerHTML = `
                <div class="log-entry">
                    <span class="log-time">[${new Date().toLocaleTimeString('en-US', { hour12: false })}]</span>
                    <span class="log-message info">System reset - RLC-H hardened glibc active</span>
                </div>
            `;
            
            isAttacking = false;
        }
        
        // Comparison flow diagrams
        function drawComparisonFlows() {
            // Standard glibc flow (vulnerable)
            const standardData = [
                { step: 1, text: 'Set GLIBC_TUNABLES', status: 'neutral' },
                { step: 2, text: 'Execute SUID binary', status: 'neutral' },
                { step: 3, text: 'ld.so parses tunables', status: 'warning' },
                { step: 4, text: 'Buffer overflow!', status: 'danger' },
                { step: 5, text: 'ROOT SHELL', status: 'danger' }
            ];
            
            const hardenedData = [
                { step: 1, text: 'Set GLIBC_TUNABLES', status: 'neutral' },
                { step: 2, text: 'Execute SUID binary', status: 'neutral' },
                { step: 3, text: 'TUNABLES stripped', status: 'success' },
                { step: 4, text: 'Safe parsing', status: 'success' },
                { step: 5, text: 'Process runs safely', status: 'success' }
            ];
            
            createFlowDiagram('#standard-flow', standardData, false);
            createFlowDiagram('#hardened-flow', hardenedData, true);
        }
        
        function createFlowDiagram(selector, data, isProtected) {
            const flowSvg = d3.select(selector)
                .append('svg')
                .attr('viewBox', '0 0 700 80')
                .attr('preserveAspectRatio', 'xMidYMid meet')
                .style('max-width', '100%');
            
            const stepWidth = 130;
            const startX = 20;
            
            data.forEach((d, i) => {
                const x = startX + i * stepWidth;
                
                // Connection line
                if (i < data.length - 1) {
                    flowSvg.append('line')
                        .attr('x1', x + 100)
                        .attr('y1', 40)
                        .attr('x2', x + stepWidth)
                        .attr('y2', 40)
                        .attr('stroke', config.colors.textSecondary)
                        .attr('stroke-width', 2)
                        .attr('stroke-dasharray', '4,4')
                        .attr('opacity', 0)
                        .transition()
                        .delay(i * 200 + 300)
                        .duration(300)
                        .attr('opacity', 0.5);
                }
                
                // Step box
                const color = d.status === 'success' ? config.colors.protected :
                             d.status === 'danger' ? config.colors.blocked :
                             d.status === 'warning' ? config.colors.canary :
                             config.colors.data;
                
                flowSvg.append('rect')
                    .attr('x', x)
                    .attr('y', 20)
                    .attr('width', 0)
                    .attr('height', 40)
                    .attr('rx', 6)
                    .attr('fill', d.status === 'neutral' ? config.colors.data : color)
                    .attr('fill-opacity', d.status === 'neutral' ? 1 : 0.2)
                    .attr('stroke', d.status === 'neutral' ? config.colors.textSecondary : color)
                    .attr('stroke-width', 1)
                    .transition()
                    .delay(i * 200)
                    .duration(400)
                    .attr('width', 100);
                
                // Step number
                flowSvg.append('text')
                    .attr('x', x + 12)
                    .attr('y', 45)
                    .style('font-size', '10px')
                    .style('font-weight', '700')
                    .style('fill', d.status === 'neutral' ? config.colors.textSecondary : color)
                    .style('opacity', 0)
                    .text(d.step)
                    .transition()
                    .delay(i * 200 + 200)
                    .duration(300)
                    .style('opacity', 1);
                
                // Step text
                flowSvg.append('text')
                    .attr('x', x + 25)
                    .attr('y', 45)
                    .style('font-size', '10px')
                    .style('fill', config.colors.text)
                    .style('opacity', 0)
                    .text(d.text)
                    .transition()
                    .delay(i * 200 + 200)
                    .duration(300)
                    .style('opacity', 1);
            });
            
            // Add CVE badge for vulnerable
            if (!isProtected) {
                flowSvg.append('rect')
                    .attr('x', startX)
                    .attr('y', 65)
                    .attr('width', 180)
                    .attr('height', 18)
                    .attr('rx', 3)
                    .attr('fill', 'rgba(248, 81, 73, 0.15)');
                
                flowSvg.append('text')
                    .attr('x', startX + 8)
                    .attr('y', 77)
                    .style('font-family', "'JetBrains Mono', monospace")
                    .style('font-size', '9px')
                    .style('fill', config.colors.blocked)
                    .text('CVE-2023-4911 ‚Ä¢ CVSS 7.8');
            } else {
                flowSvg.append('text')
                    .attr('x', startX)
                    .attr('y', 77)
                    .style('font-size', '10px')
                    .style('fill', config.colors.protected)
                    .text('‚úì Protected BEFORE CVE disclosure');
            }
        }
        
        // Feature card interactions
        document.querySelectorAll('.feature-card').forEach(card => {
            card.addEventListener('click', function() {
                document.querySelectorAll('.feature-card').forEach(c => c.classList.remove('active'));
                this.classList.add('active');
                
                const feature = this.dataset.feature;
                highlightFeature(feature);
            });
        });
        
        function highlightFeature(feature) {
            // Reset all blocks
            g.selectAll('.memory-block')
                .transition()
                .duration(300)
                .attr('opacity', 0.3);
            
            // Highlight relevant blocks based on feature
            const highlights = {
                'env-sanitization': ['.block-blocked', '.block-protected'],
                'syslog-hardening': ['.block-hardened'],
                'overflow-checks': ['.block-hardened', '.block-canary'],
                'safe-asprintf': ['.block-protected', '.block-hardened'],
                'robust-qsort': ['.block-hardened']
            };
            
            const selectors = highlights[feature] || [];
            selectors.forEach(sel => {
                g.selectAll(sel)
                    .transition()
                    .duration(300)
                    .attr('opacity', 1);
            });
            
            // Reset after 3 seconds
            setTimeout(() => {
                g.selectAll('.memory-block')
                    .transition()
                    .duration(500)
                    .attr('opacity', 1);
            }, 3000);
        }
        
        // Button handlers
        document.getElementById('btn-attack').addEventListener('click', simulateAttack);
        document.getElementById('btn-reset').addEventListener('click', resetVisualization);
        
        // Initialize
        drawMemoryVisualization();
        drawComparisonFlows();
    </script>
</body>
</html>
